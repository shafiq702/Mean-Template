'use strict';

var app = angular.module('main', ['ui.router', 'textAngular']);

app.config(function ($urlRouterProvider, $locationProvider) {
  // This turns off hashbang urls (/#about) and changes it to something normal (/about)
  // $locationProvider.html5Mode(true);
  // If we go to a URL that ui-router doesn't have registered, go to the "/" url.
  $urlRouterProvider.otherwise('/');
});

app.run(function ($rootScope, $state, AuthFactory) {
  $rootScope.$on('$stateChangeStart', function (event, next, current) {
    // AuthFactory.getUserStatus().then(function(data){console.log(data)})
    AuthFactory.getUserStatus().then(function () {
      if (next.data.restricted && !AuthFactory.isLoggedIn()) {
        event.preventDefault();
        $state.go('LoginState');
      }
    });
  });
});

app.factory('AuthFactory', function ($http) {

  var user = null;

  return {
    isLoggedIn: function isLoggedIn() {
      if (user) {
        return true;
      } else {
        return false;
      }
    },
    getUserStatus: function getUserStatus() {
      return $http.get('/auth/status')
      // handle success
      .then(function (data) {
        console.log('factory ', data.data.status);
        if (data.data.status) {
          user = true;
        } else {
          user = false;
        }
      })
      // handle error
      ['catch'](function (data) {
        user = false;
        return user;
      });
    },
    login: function login(username, password) {
      return $http.post('/auth/login', {
        username: username,
        password: password
      }).then(function (data) {
        if (data.status === 200) {
          user = true;
          return data.data;
        } else {
          user = false;
          throw new Error('testing this out');
        }
      })['catch'](function (error) {
        user = false;
        return error;
      });
    },
    logout: function logout() {
      return $http.get('/auth/logout').then(function (data) {
        user = false;
        return user;
      })['catch'](function (err) {
        user = false;
        return err;
      });
    },
    register: function register(username, password) {
      return $http.post('/auth/register', {
        username: username,
        password: password
      }).then(function (data) {
        if (data.status === 200) {
          user = true;
          return data.data;
        } else {
          user = false;
          throw new Error();
        }
      })['catch'](function (error) {
        user = false;
        return error;
      });
    }
  };
});

app.factory('BlogFactory', function ($http, AuthFactory) {
  var user = AuthFactory.currentUser();
  return {
    createPost: function createPost(post) {
      post.author = user.name;
      return $http.post('/admin/post/create', post).then(function (post) {
        return post.data;
      });
    },
    findAllPosts: function findAllPosts() {
      return $http.get('./admin/post').then(function (allPosts) {
        return allPosts.data;
      });
    }
  };
});

app.directive('navbar', function (AuthFactory, $state) {
  return {
    restrict: 'E',
    templateUrl: '/components/navbar/navbar.html',
    link: function link(scope) {
      scope.loggedIn = function () {
        return AuthFactory.isLoggedIn();
      };

      scope.logout = function () {
        return AuthFactory.logout().then(function () {
          $state.go('LoginState');
        });
      };
    }
  };
});

app.controller('HomeCtrl', function ($scope) {
  //logic here
});

app.config(function ($stateProvider) {
  $stateProvider.state('HomeState', {
    url: '/',
    templateUrl: 'app/js/home/home.html',
    controller: 'HomeCtrl',
    data: {
      restricted: false
    }
  });
});

app.controller('LoginCtrl', function ($scope, AuthFactory, $state) {

  $scope.submitLogin = function () {

    // initial values
    $scope.error = false;
    $scope.disabled = true;

    AuthFactory.login($scope.user.username, $scope.user.password).then(function (data) {
      $state.go('AdminState');
      $scope.disabled = false;
      $scope.user = {};
    }).then(null, function (err) {
      $scope.error = true;
      $scope.errorMessage = "Invalid username and/or password";
      $scope.disabled = false;
      $scope.loginForm = {};
    });
  };
});

app.config(function ($stateProvider) {
  $stateProvider.state('LoginState', {
    url: '/login',
    templateUrl: 'app/js/login/login.html',
    controller: 'LoginCtrl',
    data: {
      restricted: false
    }
  });
});

app.controller('RegisterCtrl', function ($scope, AuthFactory, $state) {

  $scope.register = function () {
    // initial values
    $scope.error = false;
    $scope.disabled = true;

    // call register from service
    AuthFactory.register($scope.registerForm.username, $scope.registerForm.password)
    // handle success
    .then(function () {
      $state.go('LoginState');
      $scope.disabled = false;
      $scope.registerForm = {};
    })
    // handle error
    ['catch'](function () {
      $scope.error = true;
      $scope.errorMessage = "Something went wrong!";
      $scope.disabled = false;
      $scope.registerForm = {};
    });
  };
});

app.config(function ($stateProvider) {
  $stateProvider.state('RegiserState', {
    url: '/register',
    templateUrl: 'app/js/register/register.html',
    controller: 'RegisterCtrl',
    data: {
      restricted: false
    }
  });
});

app.controller('CreateCtrl', function ($scope, BlogFactory, $state) {

  $scope.createPost = function () {
    BlogFactory.createPost($scope.htmlVariable).then(function () {
      $state.go('AdminPosts');
    }).then(function () {
      $scope.htmlVariable = {};
    })['catch'](function (err) {
      console.log(err);
    });
  };
});

app.config(function ($stateProvider) {
  $stateProvider.state('CreateState', {
    url: '/admin/posts/create',
    templateUrl: 'app/js/admin/blog/create.html',
    controller: 'CreateCtrl',
    data: {
      restricted: true
    }
  });
});

app.controller('PostsCtrl', function ($scope, allPosts) {
  $scope.allPosts = allPosts;
});

app.config(function ($stateProvider) {
  $stateProvider.state('AdminPosts', {
    url: '/admin/posts',
    templateUrl: 'app/js/admin/blog/posts.html',
    controller: 'PostsCtrl',
    data: {
      restricted: true
    },
    resolve: {
      allPosts: function allPosts(BlogFactory) {
        return BlogFactory.findAllPosts().then(function (allPosts) {
          return allPosts;
        });
      }
    }
  });
});

app.controller('AdminCtrl', function ($scope, $rootScope) {});

app.config(function ($stateProvider) {
  $stateProvider.state('AdminState', {
    url: '/admin',
    templateUrl: 'app/js/admin/dashboard/dashboard.html',
    controller: 'AdminCtrl',
    data: {
      restricted: true
    }
  });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImF1dGguZmFjdG9yeS5qcyIsImJsb2cuZmFjdG9yeS5qcyIsIm5hdmJhci9uYXZiYXIuZGlyZWN0aXZlLmpzIiwianMvaG9tZS9ob21lLmNvbnRyb2xsZXIuanMiLCJqcy9ob21lL2hvbWUuc3RhdGUuanMiLCJqcy9sb2dpbi9sb2dpbi5jb250cm9sbGVyLmpzIiwianMvbG9naW4vbG9naW4uc3RhdGUuanMiLCJqcy9yZWdpc3Rlci9yZWdpc3Rlci5jb250cm9sbGVyLmpzIiwianMvcmVnaXN0ZXIvcmVnaXN0ZXIuc3RhdGUuanMiLCJqcy9hZG1pbi9ibG9nL2NyZWF0ZS5jb250cm9sbGVyLmpzIiwianMvYWRtaW4vYmxvZy9jcmVhdGUuc3RhdGUuanMiLCJqcy9hZG1pbi9ibG9nL3Bvc3RzLmNvbnRyb2xsZXIuanMiLCJqcy9hZG1pbi9ibG9nL3Bvc3RzLnN0YXRlLmpzIiwianMvYWRtaW4vZGFzaGJvYXJkL2Rhc2hib2FyZC5jb250cm9sbGVyLmpzIiwianMvYWRtaW4vZGFzaGJvYXJkL2Rhc2hib2FyZC5zdGF0ZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLElBQUEsR0FBQSxHQUFBLE9BQUEsQ0FBQSxNQUFBLENBQUEsTUFBQSxFQUFBLENBQUEsV0FBQSxFQUFBLGFBQUEsQ0FBQSxDQUFBLENBQUE7O0FBRUEsR0FBQSxDQUFBLE1BQUEsQ0FBQSxVQUFBLGtCQUFBLEVBQUEsaUJBQUEsRUFBQTs7OztBQUlBLG9CQUFBLENBQUEsU0FBQSxDQUFBLEdBQUEsQ0FBQSxDQUFBO0NBQ0EsQ0FBQSxDQUFBOztBQUVBLEdBQUEsQ0FBQSxHQUFBLENBQUEsVUFBQSxVQUFBLEVBQUEsTUFBQSxFQUFBLFdBQUEsRUFBQTtBQUNBLFlBQUEsQ0FBQSxHQUFBLENBQUEsbUJBQUEsRUFBQSxVQUFBLEtBQUEsRUFBQSxJQUFBLEVBQUEsT0FBQSxFQUFBOztBQUVBLGVBQUEsQ0FBQSxhQUFBLEVBQUEsQ0FDQSxJQUFBLENBQUEsWUFBQTtBQUNBLFVBQUEsSUFBQSxDQUFBLElBQUEsQ0FBQSxVQUFBLElBQUEsQ0FBQSxXQUFBLENBQUEsVUFBQSxFQUFBLEVBQUE7QUFDQSxhQUFBLENBQUEsY0FBQSxFQUFBLENBQUE7QUFDQSxjQUFBLENBQUEsRUFBQSxDQUFBLFlBQUEsQ0FBQSxDQUFBO09BQ0E7S0FDQSxDQUFBLENBQUE7R0FJQSxDQUFBLENBQUE7Q0FDQSxDQUFBLENBQUE7O0FDdkJBLEdBQUEsQ0FBQSxPQUFBLENBQUEsYUFBQSxFQUFBLFVBQUEsS0FBQSxFQUFBOztBQUVBLE1BQUEsSUFBQSxHQUFBLElBQUEsQ0FBQTs7QUFFQSxTQUFBO0FBQ0EsY0FBQSxFQUFBLHNCQUFBO0FBQ0EsVUFBQSxJQUFBLEVBQUE7QUFDQSxlQUFBLElBQUEsQ0FBQTtPQUNBLE1BQUE7QUFDQSxlQUFBLEtBQUEsQ0FBQTtPQUNBO0tBQ0E7QUFDQSxpQkFBQSxFQUFBLHlCQUFBO0FBQ0EsYUFBQSxLQUFBLENBQUEsR0FBQSxDQUFBLGNBQUEsQ0FBQTs7T0FFQSxJQUFBLENBQUEsVUFBQSxJQUFBLEVBQUE7QUFDQSxlQUFBLENBQUEsR0FBQSxDQUFBLFVBQUEsRUFBQSxJQUFBLENBQUEsSUFBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO0FBQ0EsWUFBQSxJQUFBLENBQUEsSUFBQSxDQUFBLE1BQUEsRUFBQTtBQUNBLGNBQUEsR0FBQSxJQUFBLENBQUE7U0FDQSxNQUFBO0FBQ0EsY0FBQSxHQUFBLEtBQUEsQ0FBQTtTQUNBO09BQ0EsQ0FBQTs7ZUFFQSxDQUFBLFVBQUEsSUFBQSxFQUFBO0FBQ0EsWUFBQSxHQUFBLEtBQUEsQ0FBQTtBQUNBLGVBQUEsSUFBQSxDQUFBO09BQ0EsQ0FBQSxDQUFBO0tBQ0E7QUFDQSxTQUFBLEVBQUEsZUFBQSxRQUFBLEVBQUEsUUFBQSxFQUFBO0FBQ0EsYUFBQSxLQUFBLENBQUEsSUFBQSxDQUFBLGFBQUEsRUFBQTtBQUNBLGdCQUFBLEVBQUEsUUFBQTtBQUNBLGdCQUFBLEVBQUEsUUFBQTtPQUNBLENBQUEsQ0FDQSxJQUFBLENBQUEsVUFBQSxJQUFBLEVBQUE7QUFDQSxZQUFBLElBQUEsQ0FBQSxNQUFBLEtBQUEsR0FBQSxFQUFBO0FBQ0EsY0FBQSxHQUFBLElBQUEsQ0FBQTtBQUNBLGlCQUFBLElBQUEsQ0FBQSxJQUFBLENBQUE7U0FDQSxNQUFBO0FBQ0EsY0FBQSxHQUFBLEtBQUEsQ0FBQTtBQUNBLGdCQUFBLElBQUEsS0FBQSxDQUFBLGtCQUFBLENBQUEsQ0FBQTtTQUNBO09BQ0EsQ0FBQSxTQUNBLENBQUEsVUFBQSxLQUFBLEVBQUE7QUFDQSxZQUFBLEdBQUEsS0FBQSxDQUFBO0FBQ0EsZUFBQSxLQUFBLENBQUE7T0FDQSxDQUFBLENBQUE7S0FDQTtBQUNBLFVBQUEsRUFBQSxrQkFBQTtBQUNBLGFBQUEsS0FBQSxDQUFBLEdBQUEsQ0FBQSxjQUFBLENBQUEsQ0FDQSxJQUFBLENBQUEsVUFBQSxJQUFBLEVBQUE7QUFDQSxZQUFBLEdBQUEsS0FBQSxDQUFBO0FBQ0EsZUFBQSxJQUFBLENBQUE7T0FDQSxDQUFBLFNBQ0EsQ0FBQSxVQUFBLEdBQUEsRUFBQTtBQUNBLFlBQUEsR0FBQSxLQUFBLENBQUE7QUFDQSxlQUFBLEdBQUEsQ0FBQTtPQUNBLENBQUEsQ0FBQTtLQUNBO0FBQ0EsWUFBQSxFQUFBLGtCQUFBLFFBQUEsRUFBQSxRQUFBLEVBQUE7QUFDQSxhQUFBLEtBQUEsQ0FBQSxJQUFBLENBQUEsZ0JBQUEsRUFBQTtBQUNBLGdCQUFBLEVBQUEsUUFBQTtBQUNBLGdCQUFBLEVBQUEsUUFBQTtPQUNBLENBQUEsQ0FDQSxJQUFBLENBQUEsVUFBQSxJQUFBLEVBQUE7QUFDQSxZQUFBLElBQUEsQ0FBQSxNQUFBLEtBQUEsR0FBQSxFQUFBO0FBQ0EsY0FBQSxHQUFBLElBQUEsQ0FBQTtBQUNBLGlCQUFBLElBQUEsQ0FBQSxJQUFBLENBQUE7U0FDQSxNQUFBO0FBQ0EsY0FBQSxHQUFBLEtBQUEsQ0FBQTtBQUNBLGdCQUFBLElBQUEsS0FBQSxFQUFBLENBQUE7U0FDQTtPQUNBLENBQUEsU0FDQSxDQUFBLFVBQUEsS0FBQSxFQUFBO0FBQ0EsWUFBQSxHQUFBLEtBQUEsQ0FBQTtBQUNBLGVBQUEsS0FBQSxDQUFBO09BQ0EsQ0FBQSxDQUFBO0tBQ0E7R0FDQSxDQUFBO0NBQ0EsQ0FBQSxDQUFBOztBQy9FQSxHQUFBLENBQUEsT0FBQSxDQUFBLGFBQUEsRUFBQSxVQUFBLEtBQUEsRUFBQSxXQUFBLEVBQUE7QUFDQSxNQUFBLElBQUEsR0FBQSxXQUFBLENBQUEsV0FBQSxFQUFBLENBQUE7QUFDQSxTQUFBO0FBQ0EsY0FBQSxFQUFBLG9CQUFBLElBQUEsRUFBQTtBQUNBLFVBQUEsQ0FBQSxNQUFBLEdBQUEsSUFBQSxDQUFBLElBQUEsQ0FBQTtBQUNBLGFBQUEsS0FBQSxDQUFBLElBQUEsQ0FBQSxvQkFBQSxFQUFBLElBQUEsQ0FBQSxDQUNBLElBQUEsQ0FBQSxVQUFBLElBQUEsRUFBQTtBQUNBLGVBQUEsSUFBQSxDQUFBLElBQUEsQ0FBQTtPQUNBLENBQUEsQ0FBQTtLQUNBO0FBQ0EsZ0JBQUEsRUFBQSx3QkFBQTtBQUNBLGFBQUEsS0FBQSxDQUFBLEdBQUEsQ0FBQSxjQUFBLENBQUEsQ0FDQSxJQUFBLENBQUEsVUFBQSxRQUFBLEVBQUE7QUFDQSxlQUFBLFFBQUEsQ0FBQSxJQUFBLENBQUE7T0FDQSxDQUFBLENBQUE7S0FDQTtHQUNBLENBQUE7Q0FDQSxDQUFBLENBQUE7O0FDakJBLEdBQUEsQ0FBQSxTQUFBLENBQUEsUUFBQSxFQUFBLFVBQUEsV0FBQSxFQUFBLE1BQUEsRUFBQTtBQUNBLFNBQUE7QUFDQSxZQUFBLEVBQUEsR0FBQTtBQUNBLGVBQUEsRUFBQSxnQ0FBQTtBQUNBLFFBQUEsRUFBQSxjQUFBLEtBQUEsRUFBQTtBQUNBLFdBQUEsQ0FBQSxRQUFBLEdBQUEsWUFBQTtBQUNBLGVBQUEsV0FBQSxDQUFBLFVBQUEsRUFBQSxDQUFBO09BQ0EsQ0FBQTs7QUFFQSxXQUFBLENBQUEsTUFBQSxHQUFBLFlBQUE7QUFDQSxlQUFBLFdBQUEsQ0FBQSxNQUFBLEVBQUEsQ0FDQSxJQUFBLENBQUEsWUFBQTtBQUNBLGdCQUFBLENBQUEsRUFBQSxDQUFBLFlBQUEsQ0FBQSxDQUFBO1NBQ0EsQ0FBQSxDQUFBO09BQ0EsQ0FBQTtLQUNBO0dBQ0EsQ0FBQTtDQUNBLENBQUEsQ0FBQTs7QUNqQkEsR0FBQSxDQUFBLFVBQUEsQ0FBQSxVQUFBLEVBQUEsVUFBQSxNQUFBLEVBQUE7O0NBRUEsQ0FBQSxDQUFBOztBQ0ZBLEdBQUEsQ0FBQSxNQUFBLENBQUEsVUFBQSxjQUFBLEVBQUE7QUFDQSxnQkFBQSxDQUFBLEtBQUEsQ0FBQSxXQUFBLEVBQUE7QUFDQSxPQUFBLEVBQUEsR0FBQTtBQUNBLGVBQUEsRUFBQSx1QkFBQTtBQUNBLGNBQUEsRUFBQSxVQUFBO0FBQ0EsUUFBQSxFQUFBO0FBQ0EsZ0JBQUEsRUFBQSxLQUFBO0tBQ0E7R0FDQSxDQUFBLENBQUE7Q0FDQSxDQUFBLENBQUE7O0FDVEEsR0FBQSxDQUFBLFVBQUEsQ0FBQSxXQUFBLEVBQUEsVUFBQSxNQUFBLEVBQUEsV0FBQSxFQUFBLE1BQUEsRUFBQTs7QUFFQSxRQUFBLENBQUEsV0FBQSxHQUFBLFlBQUE7OztBQUdBLFVBQUEsQ0FBQSxLQUFBLEdBQUEsS0FBQSxDQUFBO0FBQ0EsVUFBQSxDQUFBLFFBQUEsR0FBQSxJQUFBLENBQUE7O0FBRUEsZUFBQSxDQUFBLEtBQUEsQ0FBQSxNQUFBLENBQUEsSUFBQSxDQUFBLFFBQUEsRUFBQSxNQUFBLENBQUEsSUFBQSxDQUFBLFFBQUEsQ0FBQSxDQUNBLElBQUEsQ0FBQSxVQUFBLElBQUEsRUFBQTtBQUNBLFlBQUEsQ0FBQSxFQUFBLENBQUEsWUFBQSxDQUFBLENBQUE7QUFDQSxZQUFBLENBQUEsUUFBQSxHQUFBLEtBQUEsQ0FBQTtBQUNBLFlBQUEsQ0FBQSxJQUFBLEdBQUEsRUFBQSxDQUFBO0tBQ0EsQ0FBQSxDQUNBLElBQUEsQ0FBQSxJQUFBLEVBQUEsVUFBQSxHQUFBLEVBQUE7QUFDQSxZQUFBLENBQUEsS0FBQSxHQUFBLElBQUEsQ0FBQTtBQUNBLFlBQUEsQ0FBQSxZQUFBLEdBQUEsa0NBQUEsQ0FBQTtBQUNBLFlBQUEsQ0FBQSxRQUFBLEdBQUEsS0FBQSxDQUFBO0FBQ0EsWUFBQSxDQUFBLFNBQUEsR0FBQSxFQUFBLENBQUE7S0FDQSxDQUFBLENBQUE7R0FDQSxDQUFBO0NBQ0EsQ0FBQSxDQUFBOztBQ3JCQSxHQUFBLENBQUEsTUFBQSxDQUFBLFVBQUEsY0FBQSxFQUFBO0FBQ0EsZ0JBQUEsQ0FBQSxLQUFBLENBQUEsWUFBQSxFQUFBO0FBQ0EsT0FBQSxFQUFBLFFBQUE7QUFDQSxlQUFBLEVBQUEseUJBQUE7QUFDQSxjQUFBLEVBQUEsV0FBQTtBQUNBLFFBQUEsRUFBQTtBQUNBLGdCQUFBLEVBQUEsS0FBQTtLQUNBO0dBQ0EsQ0FBQSxDQUFBO0NBQ0EsQ0FBQSxDQUFBOztBQ1RBLEdBQUEsQ0FBQSxVQUFBLENBQUEsY0FBQSxFQUFBLFVBQUEsTUFBQSxFQUFBLFdBQUEsRUFBQSxNQUFBLEVBQUE7O0FBRUEsUUFBQSxDQUFBLFFBQUEsR0FBQSxZQUFBOztBQUVBLFVBQUEsQ0FBQSxLQUFBLEdBQUEsS0FBQSxDQUFBO0FBQ0EsVUFBQSxDQUFBLFFBQUEsR0FBQSxJQUFBLENBQUE7OztBQUdBLGVBQUEsQ0FBQSxRQUFBLENBQUEsTUFBQSxDQUFBLFlBQUEsQ0FBQSxRQUFBLEVBQUEsTUFBQSxDQUFBLFlBQUEsQ0FBQSxRQUFBLENBQUE7O0tBRUEsSUFBQSxDQUFBLFlBQUE7QUFDQSxZQUFBLENBQUEsRUFBQSxDQUFBLFlBQUEsQ0FBQSxDQUFBO0FBQ0EsWUFBQSxDQUFBLFFBQUEsR0FBQSxLQUFBLENBQUE7QUFDQSxZQUFBLENBQUEsWUFBQSxHQUFBLEVBQUEsQ0FBQTtLQUNBLENBQUE7O2FBRUEsQ0FBQSxZQUFBO0FBQ0EsWUFBQSxDQUFBLEtBQUEsR0FBQSxJQUFBLENBQUE7QUFDQSxZQUFBLENBQUEsWUFBQSxHQUFBLHVCQUFBLENBQUE7QUFDQSxZQUFBLENBQUEsUUFBQSxHQUFBLEtBQUEsQ0FBQTtBQUNBLFlBQUEsQ0FBQSxZQUFBLEdBQUEsRUFBQSxDQUFBO0tBQ0EsQ0FBQSxDQUFBO0dBQ0EsQ0FBQTtDQUVBLENBQUEsQ0FBQTs7QUN4QkEsR0FBQSxDQUFBLE1BQUEsQ0FBQSxVQUFBLGNBQUEsRUFBQTtBQUNBLGdCQUFBLENBQUEsS0FBQSxDQUFBLGNBQUEsRUFBQTtBQUNBLE9BQUEsRUFBQSxXQUFBO0FBQ0EsZUFBQSxFQUFBLCtCQUFBO0FBQ0EsY0FBQSxFQUFBLGNBQUE7QUFDQSxRQUFBLEVBQUE7QUFDQSxnQkFBQSxFQUFBLEtBQUE7S0FDQTtHQUNBLENBQUEsQ0FBQTtDQUNBLENBQUEsQ0FBQTs7QUNUQSxHQUFBLENBQUEsVUFBQSxDQUFBLFlBQUEsRUFBQSxVQUFBLE1BQUEsRUFBQSxXQUFBLEVBQUEsTUFBQSxFQUFBOztBQUVBLFFBQUEsQ0FBQSxVQUFBLEdBQUEsWUFBQTtBQUNBLGVBQUEsQ0FBQSxVQUFBLENBQUEsTUFBQSxDQUFBLFlBQUEsQ0FBQSxDQUNBLElBQUEsQ0FBQSxZQUFBO0FBQ0EsWUFBQSxDQUFBLEVBQUEsQ0FBQSxZQUFBLENBQUEsQ0FBQTtLQUNBLENBQUEsQ0FDQSxJQUFBLENBQUEsWUFBQTtBQUNBLFlBQUEsQ0FBQSxZQUFBLEdBQUEsRUFBQSxDQUFBO0tBQ0EsQ0FBQSxTQUNBLENBQUEsVUFBQSxHQUFBLEVBQUE7QUFDQSxhQUFBLENBQUEsR0FBQSxDQUFBLEdBQUEsQ0FBQSxDQUFBO0tBQ0EsQ0FBQSxDQUFBO0dBQ0EsQ0FBQTtDQUVBLENBQUEsQ0FBQTs7QUNmQSxHQUFBLENBQUEsTUFBQSxDQUFBLFVBQUEsY0FBQSxFQUFBO0FBQ0EsZ0JBQUEsQ0FBQSxLQUFBLENBQUEsYUFBQSxFQUFBO0FBQ0EsT0FBQSxFQUFBLHFCQUFBO0FBQ0EsZUFBQSxFQUFBLCtCQUFBO0FBQ0EsY0FBQSxFQUFBLFlBQUE7QUFDQSxRQUFBLEVBQUE7QUFDQSxnQkFBQSxFQUFBLElBQUE7S0FDQTtHQUNBLENBQUEsQ0FBQTtDQUNBLENBQUEsQ0FBQTs7QUNUQSxHQUFBLENBQUEsVUFBQSxDQUFBLFdBQUEsRUFBQSxVQUFBLE1BQUEsRUFBQSxRQUFBLEVBQUE7QUFDQSxRQUFBLENBQUEsUUFBQSxHQUFBLFFBQUEsQ0FBQTtDQUNBLENBQUEsQ0FBQTs7QUNGQSxHQUFBLENBQUEsTUFBQSxDQUFBLFVBQUEsY0FBQSxFQUFBO0FBQ0EsZ0JBQUEsQ0FBQSxLQUFBLENBQUEsWUFBQSxFQUFBO0FBQ0EsT0FBQSxFQUFBLGNBQUE7QUFDQSxlQUFBLEVBQUEsOEJBQUE7QUFDQSxjQUFBLEVBQUEsV0FBQTtBQUNBLFFBQUEsRUFBQTtBQUNBLGdCQUFBLEVBQUEsSUFBQTtLQUNBO0FBQ0EsV0FBQSxFQUFBO0FBQ0EsY0FBQSxFQUFBLGtCQUFBLFdBQUEsRUFBQTtBQUNBLGVBQUEsV0FBQSxDQUFBLFlBQUEsRUFBQSxDQUNBLElBQUEsQ0FBQSxVQUFBLFFBQUEsRUFBQTtBQUNBLGlCQUFBLFFBQUEsQ0FBQTtTQUNBLENBQUEsQ0FBQTtPQUNBO0tBQ0E7R0FDQSxDQUFBLENBQUE7Q0FDQSxDQUFBLENBQUE7O0FDakJBLEdBQUEsQ0FBQSxVQUFBLENBQUEsV0FBQSxFQUFBLFVBQUEsTUFBQSxFQUFBLFVBQUEsRUFBQSxFQUVBLENBQUEsQ0FBQTs7QUNGQSxHQUFBLENBQUEsTUFBQSxDQUFBLFVBQUEsY0FBQSxFQUFBO0FBQ0EsZ0JBQUEsQ0FBQSxLQUFBLENBQUEsWUFBQSxFQUFBO0FBQ0EsT0FBQSxFQUFBLFFBQUE7QUFDQSxlQUFBLEVBQUEsdUNBQUE7QUFDQSxjQUFBLEVBQUEsV0FBQTtBQUNBLFFBQUEsRUFBQTtBQUNBLGdCQUFBLEVBQUEsSUFBQTtLQUNBO0dBQ0EsQ0FBQSxDQUFBO0NBQ0EsQ0FBQSxDQUFBIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ21haW4nLCBbJ3VpLnJvdXRlcicsICd0ZXh0QW5ndWxhciddKTtcblxuYXBwLmNvbmZpZyhmdW5jdGlvbigkdXJsUm91dGVyUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyKXtcblx0Ly8gVGhpcyB0dXJucyBvZmYgaGFzaGJhbmcgdXJscyAoLyNhYm91dCkgYW5kIGNoYW5nZXMgaXQgdG8gc29tZXRoaW5nIG5vcm1hbCAoL2Fib3V0KVxuXHQvLyAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XG5cdC8vIElmIHdlIGdvIHRvIGEgVVJMIHRoYXQgdWktcm91dGVyIGRvZXNuJ3QgaGF2ZSByZWdpc3RlcmVkLCBnbyB0byB0aGUgXCIvXCIgdXJsLlxuICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvJyk7XG59KVxuXG5hcHAucnVuKGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkc3RhdGUsIEF1dGhGYWN0b3J5KSB7XG4gICRyb290U2NvcGUuJG9uKCckc3RhdGVDaGFuZ2VTdGFydCcsIGZ1bmN0aW9uIChldmVudCwgbmV4dCwgY3VycmVudCkge1xuICAgIC8vIEF1dGhGYWN0b3J5LmdldFVzZXJTdGF0dXMoKS50aGVuKGZ1bmN0aW9uKGRhdGEpe2NvbnNvbGUubG9nKGRhdGEpfSlcbiAgICBBdXRoRmFjdG9yeS5nZXRVc2VyU3RhdHVzKClcbiAgICAudGhlbihmdW5jdGlvbigpe1xuICAgICAgaWYgKG5leHQuZGF0YS5yZXN0cmljdGVkICYmICFBdXRoRmFjdG9yeS5pc0xvZ2dlZEluKCkpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKVxuICAgICAgICAkc3RhdGUuZ28oJ0xvZ2luU3RhdGUnKTtcbiAgICAgIH1cbiAgICB9KVxuXG5cblxuICB9KTtcbn0pO1xuIiwiYXBwLmZhY3RvcnkoJ0F1dGhGYWN0b3J5JywgZnVuY3Rpb24oJGh0dHApIHtcblxuICB2YXIgdXNlciA9IG51bGw7XG5cbiAgcmV0dXJuIHtcbiAgICBpc0xvZ2dlZEluOiBmdW5jdGlvbigpIHtcbiAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH0sXG4gICAgZ2V0VXNlclN0YXR1czogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXV0aC9zdGF0dXMnKVxuICAgICAgICAvLyBoYW5kbGUgc3VjY2Vzc1xuICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ2ZhY3RvcnkgJyxkYXRhLmRhdGEuc3RhdHVzKVxuICAgICAgICAgIGlmIChkYXRhLmRhdGEuc3RhdHVzKSB7XG4gICAgICAgICAgICB1c2VyID0gdHJ1ZTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdXNlciA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgLy8gaGFuZGxlIGVycm9yXG4gICAgICAgIC5jYXRjaChmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgdXNlciA9IGZhbHNlO1xuICAgICAgICAgIHJldHVybiB1c2VyXG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgbG9naW46IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xuICAgICAgcmV0dXJuICRodHRwLnBvc3QoJy9hdXRoL2xvZ2luJywge1xuICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZSxcbiAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgIGlmIChkYXRhLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICB1c2VyID0gdHJ1ZTtcbiAgICAgICAgICAgIHJldHVybiBkYXRhLmRhdGFcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdXNlciA9IGZhbHNlO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCd0ZXN0aW5nIHRoaXMgb3V0JylcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgIHVzZXIgPSBmYWxzZTtcbiAgICAgICAgICByZXR1cm4gZXJyb3JcbiAgICAgICAgfSlcbiAgICB9LFxuICAgIGxvZ291dDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXV0aC9sb2dvdXQnKVxuICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgdXNlciA9IGZhbHNlO1xuICAgICAgICAgIHJldHVybiB1c2VyXG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICB1c2VyID0gZmFsc2U7XG4gICAgICAgICAgcmV0dXJuIGVyclxuICAgICAgICB9KVxuICAgIH0sXG4gICAgcmVnaXN0ZXI6IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xuICAgICAgcmV0dXJuICRodHRwLnBvc3QoJy9hdXRoL3JlZ2lzdGVyJywge1xuICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZSxcbiAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgIGlmIChkYXRhLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICB1c2VyID0gdHJ1ZTtcbiAgICAgICAgICAgIHJldHVybiBkYXRhLmRhdGFcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdXNlciA9IGZhbHNlO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKClcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgIHVzZXIgPSBmYWxzZTtcbiAgICAgICAgICByZXR1cm4gZXJyb3JcbiAgICAgICAgfSlcbiAgICB9XG4gIH1cbn0pXG4iLCJhcHAuZmFjdG9yeSgnQmxvZ0ZhY3RvcnknLGZ1bmN0aW9uKCRodHRwLCBBdXRoRmFjdG9yeSl7XG5cdHZhciB1c2VyID0gQXV0aEZhY3RvcnkuY3VycmVudFVzZXIoKTtcblx0cmV0dXJuIHtcblx0XHRjcmVhdGVQb3N0OiBmdW5jdGlvbihwb3N0KXtcblx0XHRcdHBvc3QuYXV0aG9yID0gdXNlci5uYW1lXG5cdFx0XHRyZXR1cm4gJGh0dHAucG9zdCgnL2FkbWluL3Bvc3QvY3JlYXRlJywgcG9zdClcbiAgICAgIC50aGVuKGZ1bmN0aW9uKHBvc3Qpe1xuICAgICAgICByZXR1cm4gcG9zdC5kYXRhXG4gICAgICB9KVxuXHRcdH0sXG5cdFx0ZmluZEFsbFBvc3RzOiBmdW5jdGlvbigpe1xuXHRcdFx0cmV0dXJuICRodHRwLmdldCgnLi9hZG1pbi9wb3N0Jylcblx0XHRcdC50aGVuKGZ1bmN0aW9uKGFsbFBvc3RzKXtcblx0XHRcdFx0cmV0dXJuIGFsbFBvc3RzLmRhdGFcblx0XHRcdH0pXG5cdFx0fVxuICB9XG59KVxuIiwiYXBwLmRpcmVjdGl2ZSgnbmF2YmFyJywgZnVuY3Rpb24oQXV0aEZhY3RvcnksICRzdGF0ZSl7XG5cdHJldHVybiB7XG5cdFx0cmVzdHJpY3Q6ICdFJyxcblx0XHR0ZW1wbGF0ZVVybDogJy9jb21wb25lbnRzL25hdmJhci9uYXZiYXIuaHRtbCcsXG5cdFx0bGluazogZnVuY3Rpb24oc2NvcGUpe1xuXHRcdFx0c2NvcGUubG9nZ2VkSW4gPSBmdW5jdGlvbigpe1xuXHRcdFx0XHRyZXR1cm4gQXV0aEZhY3RvcnkuaXNMb2dnZWRJbigpO1xuXHRcdFx0fTtcblxuXHRcdFx0c2NvcGUubG9nb3V0ID0gZnVuY3Rpb24oKXtcblx0XHRcdFx0cmV0dXJuIEF1dGhGYWN0b3J5LmxvZ291dCgpXG5cdFx0XHRcdC50aGVuKGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0JHN0YXRlLmdvKCdMb2dpblN0YXRlJylcblx0XHRcdFx0fSlcblx0XHRcdH1cblx0XHR9XG5cdH1cbn0pXG4iLCJhcHAuY29udHJvbGxlcignSG9tZUN0cmwnLCBmdW5jdGlvbigkc2NvcGUpe1xuICAvL2xvZ2ljIGhlcmVcbn0pO1xuIiwiYXBwLmNvbmZpZyhmdW5jdGlvbiAoJHN0YXRlUHJvdmlkZXIpIHtcblx0JHN0YXRlUHJvdmlkZXIuc3RhdGUoJ0hvbWVTdGF0ZScsIHtcblx0XHR1cmw6ICcvJyxcblx0XHR0ZW1wbGF0ZVVybDogJ2FwcC9qcy9ob21lL2hvbWUuaHRtbCcsXG4gICAgY29udHJvbGxlcjogJ0hvbWVDdHJsJyxcblx0XHRkYXRhOiB7XG5cdFx0XHRyZXN0cmljdGVkOiBmYWxzZVxuXHRcdH1cblx0fSk7XG59KTtcbiIsImFwcC5jb250cm9sbGVyKCdMb2dpbkN0cmwnLCBmdW5jdGlvbigkc2NvcGUsIEF1dGhGYWN0b3J5LCAkc3RhdGUpIHtcblxuICAkc2NvcGUuc3VibWl0TG9naW4gPSBmdW5jdGlvbigpIHtcblxuICAgIC8vIGluaXRpYWwgdmFsdWVzXG4gICAgJHNjb3BlLmVycm9yID0gZmFsc2U7XG4gICAgJHNjb3BlLmRpc2FibGVkID0gdHJ1ZTtcblxuICAgIEF1dGhGYWN0b3J5LmxvZ2luKCRzY29wZS51c2VyLnVzZXJuYW1lLCAkc2NvcGUudXNlci5wYXNzd29yZClcbiAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAkc3RhdGUuZ28oJ0FkbWluU3RhdGUnKVxuICAgICAgICAgICRzY29wZS5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICAgICRzY29wZS51c2VyID0ge307XG4gICAgICB9KVxuICAgICAgLnRoZW4obnVsbCwgZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICRzY29wZS5lcnJvciA9IHRydWU7XG4gICAgICAgICRzY29wZS5lcnJvck1lc3NhZ2UgPSBcIkludmFsaWQgdXNlcm5hbWUgYW5kL29yIHBhc3N3b3JkXCI7XG4gICAgICAgICRzY29wZS5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICAkc2NvcGUubG9naW5Gb3JtID0ge307XG4gICAgICB9KVxuICB9XG59KTtcbiIsImFwcC5jb25maWcoZnVuY3Rpb24gKCRzdGF0ZVByb3ZpZGVyKSB7XG5cdCRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdMb2dpblN0YXRlJywge1xuXHRcdHVybDogJy9sb2dpbicsXG5cdFx0dGVtcGxhdGVVcmw6ICdhcHAvanMvbG9naW4vbG9naW4uaHRtbCcsXG4gICAgY29udHJvbGxlcjogJ0xvZ2luQ3RybCcsXG5cdFx0ZGF0YToge1xuXHRcdFx0cmVzdHJpY3RlZDogZmFsc2Vcblx0XHR9XG5cdH0pO1xufSk7XG4iLCJhcHAuY29udHJvbGxlcignUmVnaXN0ZXJDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBBdXRoRmFjdG9yeSwgJHN0YXRlKSB7XG5cbiAgJHNjb3BlLnJlZ2lzdGVyID0gZnVuY3Rpb24oKSB7XG4gICAgLy8gaW5pdGlhbCB2YWx1ZXNcbiAgICAkc2NvcGUuZXJyb3IgPSBmYWxzZTtcbiAgICAkc2NvcGUuZGlzYWJsZWQgPSB0cnVlO1xuXG4gICAgLy8gY2FsbCByZWdpc3RlciBmcm9tIHNlcnZpY2VcbiAgICBBdXRoRmFjdG9yeS5yZWdpc3Rlcigkc2NvcGUucmVnaXN0ZXJGb3JtLnVzZXJuYW1lLCAkc2NvcGUucmVnaXN0ZXJGb3JtLnBhc3N3b3JkKVxuICAgICAgLy8gaGFuZGxlIHN1Y2Nlc3NcbiAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAkc3RhdGUuZ28oJ0xvZ2luU3RhdGUnKVxuICAgICAgICAkc2NvcGUuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgJHNjb3BlLnJlZ2lzdGVyRm9ybSA9IHt9O1xuICAgICAgfSlcbiAgICAgIC8vIGhhbmRsZSBlcnJvclxuICAgICAgLmNhdGNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAkc2NvcGUuZXJyb3IgPSB0cnVlO1xuICAgICAgICAkc2NvcGUuZXJyb3JNZXNzYWdlID0gXCJTb21ldGhpbmcgd2VudCB3cm9uZyFcIjtcbiAgICAgICAgJHNjb3BlLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgICRzY29wZS5yZWdpc3RlckZvcm0gPSB7fTtcbiAgICAgIH0pO1xuICB9O1xuXG59KTtcbiIsImFwcC5jb25maWcoZnVuY3Rpb24gKCRzdGF0ZVByb3ZpZGVyKSB7XG5cdCRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdSZWdpc2VyU3RhdGUnLCB7XG5cdFx0dXJsOiAnL3JlZ2lzdGVyJyxcblx0XHR0ZW1wbGF0ZVVybDogJ2FwcC9qcy9yZWdpc3Rlci9yZWdpc3Rlci5odG1sJyxcbiAgICBjb250cm9sbGVyOiAnUmVnaXN0ZXJDdHJsJyxcblx0XHRkYXRhOiB7XG5cdFx0XHRyZXN0cmljdGVkOiBmYWxzZVxuXHRcdH1cblx0fSk7XG59KTtcbiIsImFwcC5jb250cm9sbGVyKCdDcmVhdGVDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBCbG9nRmFjdG9yeSwgJHN0YXRlKXtcblxuICAkc2NvcGUuY3JlYXRlUG9zdCA9IGZ1bmN0aW9uKCl7XG4gICAgICBCbG9nRmFjdG9yeS5jcmVhdGVQb3N0KCRzY29wZS5odG1sVmFyaWFibGUpXG4gICAgICAudGhlbihmdW5jdGlvbigpe1xuICAgICAgICAkc3RhdGUuZ28oJ0FkbWluUG9zdHMnKVxuICAgICAgfSlcbiAgICAgIC50aGVuKGZ1bmN0aW9uKCl7XG4gICAgICAgICRzY29wZS5odG1sVmFyaWFibGUgPSB7fTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKXtcbiAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgIH0pXG4gIH1cblxufSk7XG4iLCJhcHAuY29uZmlnKGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlcikge1xuXHQkc3RhdGVQcm92aWRlci5zdGF0ZSgnQ3JlYXRlU3RhdGUnLCB7XG4gICAgICAgICAgICB1cmw6ICcvYWRtaW4vcG9zdHMvY3JlYXRlJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL2pzL2FkbWluL2Jsb2cvY3JlYXRlLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0NyZWF0ZUN0cmwnLFxuXHRcdFx0XHRcdFx0ZGF0YToge1xuXHRcdFx0XHRcdFx0XHRyZXN0cmljdGVkOiB0cnVlXG5cdFx0XHRcdFx0XHR9XG4gICAgICAgIH0pXG59KTtcbiIsImFwcC5jb250cm9sbGVyKCdQb3N0c0N0cmwnLCBmdW5jdGlvbigkc2NvcGUsIGFsbFBvc3RzKXtcbiAgJHNjb3BlLmFsbFBvc3RzID0gYWxsUG9zdHM7XG59KTtcbiIsImFwcC5jb25maWcoZnVuY3Rpb24gKCRzdGF0ZVByb3ZpZGVyKSB7XG5cdCRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdBZG1pblBvc3RzJywge1xuICAgICAgICAgICAgdXJsOiAnL2FkbWluL3Bvc3RzJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL2pzL2FkbWluL2Jsb2cvcG9zdHMuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnUG9zdHNDdHJsJyxcblx0XHRcdFx0XHRcdGRhdGE6IHtcblx0XHRcdFx0XHRcdFx0cmVzdHJpY3RlZDogdHJ1ZVxuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdHJlc29sdmU6IHtcblx0XHRcdFx0XHRcdFx0YWxsUG9zdHM6IGZ1bmN0aW9uKEJsb2dGYWN0b3J5KXtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gQmxvZ0ZhY3RvcnkuZmluZEFsbFBvc3RzKClcblx0XHRcdFx0XHRcdFx0XHQudGhlbihmdW5jdGlvbihhbGxQb3N0cyl7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gYWxsUG9zdHNcblx0XHRcdFx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG4gICAgICAgIH0pXG59KTtcbiIsImFwcC5jb250cm9sbGVyKCdBZG1pbkN0cmwnLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUpe1xuXG59KTtcbiIsImFwcC5jb25maWcoZnVuY3Rpb24gKCRzdGF0ZVByb3ZpZGVyKSB7XG5cdCRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdBZG1pblN0YXRlJywge1xuXHRcdHVybDogJy9hZG1pbicsXG5cdFx0dGVtcGxhdGVVcmw6ICdhcHAvanMvYWRtaW4vZGFzaGJvYXJkL2Rhc2hib2FyZC5odG1sJyxcbiAgICBjb250cm9sbGVyOiAnQWRtaW5DdHJsJyxcblx0XHRkYXRhOiB7XG5cdFx0XHRyZXN0cmljdGVkOiB0cnVlXG5cdFx0fVxuXHR9KVxufSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
